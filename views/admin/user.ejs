<% include partials/header %>

<style>
    .vertical-line {
        border-right: 1px solid rgba(200,200,200, .7);
    }

    .pointer{
        cursor: pointer;
    }
</style>

<script src="/js/user.js"></script>

<div class="container">
    <div class="row">
        <div class="col-8">
            <div class="row">
                <div class="col-2">
                    <p><strong>Navn:</strong></p>
                    <p><strong>Adresse:</strong></p>
                    <p><strong>E-mail:</strong></p>
                    <p><strong>Telefon:</strong></p>                    
                </div>
                <div class="col-5">
                    <p><%= user.firstName + " " + user.lastName %></p>
                    <p><%= user.street + " " + user.houseNumber %> , <%= user.zipcode + " " + user.town %></p>
                    <p><%= user.username %></p>
                    <p><%= user.phone %></p>                    
                </div>
            </div>
        </div>
        <div class="col-4">
            <img src="<%= user.avatarURL %>" width="200">
        </div>
    </div>


    <a href="#" class="btn btn-outline-success">Chat med bruger </a>

    <!-- Vægt -->
    <div class="row my-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <div class="row">
                        <div class="col-5">
                            <h4>Vægt</h4>
                        </div>
                        <div class="col-7">
                            <form class="form-inline float-right" action="<%= user._id %>/update/weight" method="post">
                                <div class="form-group">
                                    <input name="newGoal" type="number" class="form-control mr-1" placeholder="indtast nyt mål...">
                                    <button type="submit" class="btn btn-outline-primary pointer">Nyt mål</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-3 vertical-line">
                            <p class="my-1"> Mål vægt <span class="float-right"> <%= user.weightStats.targetWeight %> </span> </p>        
                            <p class="my-1"> Start vægt <span class="float-right"> <%= user.weightStats.startWeight %> </span> </p>                                              
                        </div>
                        <div class="col-3">
                                <p class="my-1"> Nuværende vægt <span class="float-right"> <%= user.weightStats.currentWeight %> </span> </p>
                            <p class="my-1"> Vægt progression <span class="float-right"> <%= user.weightStats.weightProgress.toFixed(1) %> </span> </p>
                        </div>
                    </div>               
                </div>
            </div>
        </div>
    </div>

    <!-- Træning -->
    <div class="row my-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <div class="row">
                        <div class="col-9">
                            <h4>Træningsprogram</h4>
                        </div>
                        <div class="col-3">
                            <button class="btn btn-outline-primary float-right pointer" onclick="appendPas()">Nyt pas</button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <% user.trainingStats.trainingPases.forEach((trainingPas) => { %>
                            <div class="col-6">
                                <div class="card m-1 my-4">
                                    <div class="card-header text-white bg-dark">
                                        <div class="row">
                                            <div class="col-8">
                                                <h5> Pas <%= trainingPas.pasNumber %> </h5>
                                            </div>
                                            <div class="col-4">
                                                <button onclick="toggleEditButtons('<%= trainingPas.pasNumber %>')"  class="btn btn-sm btn-success float-right pointer">
                                                    <i class="fa fa-lg fa-pencil-square-o" aria-hidden="true"></i>
                                                </button>                                                    
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body pt-0 bg-light">
                                    <% trainingPas.muscleGroups.forEach((muscleGroup) => { %>
                                        <h5 class="mt-4 text-capitalize"> <%= muscleGroup.name %> </h5>
                                        <div class="list-group list-unstyled" style="position: relative;">
                                            <% muscleGroup.assignedWorkouts.forEach((userWorkout) => { %>
                                                <!-- Div for the workout details -->
                                                <div id="noEdit<%= userWorkout._id %>" class=" mt-1"> 
                                                    <span class="editButtons<%= trainingPas.pasNumber %>" style="display: none;"> 
                                                        <span onclick="deleteWorkout('<%=trainingPas.pasNumber%>' , '<%= muscleGroup.name %>' , '<%= userWorkout.name %>', '<%= userWorkout._id %>')"> 
                                                            <i class="fa fa-trash text-danger pointer" aria-hidden="true"></i> 
                                                        </span>
                                                        <span onclick="toggleEdit('<%= userWorkout._id %>')"> <i class="fa fa-pencil text-info pointer" aria-hidden="true"></i> </span>
                                                    </span>
                                                    <span class="text-capitalize" id="name<%= userWorkout._id %>"> <%= userWorkout.name %> </span> 
                                                    <span id="reps<%= userWorkout._id %>" class="float-right"> <%= userWorkout.reps %> gentagelser </span>
                                                    <span id="saet<%= userWorkout._id %>" class="float-right mr-1">  <%= userWorkout.saet %> sæt af </span>
                                                </div>
                                                <!-- Div for the workout edit form -->
                                                <div id="edit<%= userWorkout._id %>" style="display: none;" class="mt-1"> 
                                                    <form id="form<%= userWorkout._id %>" class="form-inline" action="<%=user._id%>/update/workout/<%=userWorkout._id%>" type="POST">
                                                        <div class="input-group">
                                                            <select class="form-control text-capitalize" name="name">
                                                                <% workouts.forEach((workout) => { %>
                                                                    <% if(userWorkout.name === workout.name) { %>
                                                                        <option class="text-capitalize" selected="true" value="<%= workout.name %>"><%= workout.name %></option>
                                                                    <% } else { %>
                                                                        <option class="text-capitalize" value="<%= workout.name %>"><%= workout.name %></option>
                                                                    <% } %>
                                                                <% }) %>
                                                            </select>
                                                            <input type="number" name="saet" class="form-control"  placeholder="Sæt">
                                                            <input type="number" name="reps" class="form-control"  placeholder="Gentagelser">                                                          
                                                            <button 
                                                                type="button" 
                                                                onclick="updateWorkout('<%=trainingPas.pasNumber%>' , '<%= muscleGroup.name %>' , '<%= userWorkout.name %>', '<%= userWorkout._id %>')" 
                                                                class="btn btn-primary btn-sm">Gem
                                                            </button>
                                                        </div>
                                                    </form>
                                                </div>
                                            <% }) %>
                                            <!-- Div for add new workout form -->
                                            <div style="display: none;" class="my-2 editButtons<%= trainingPas.pasNumber %>">                                                     
                                                <form id="createExc<%= muscleGroup._id%>" class="form-inline" action="<%=user._id%>/create/workout" type="POST">
                                                    <div class="input-group">
                                                        <select class="form-control text-capitalize" name="name">
                                                            <% workouts.forEach((workout) => { %>
                                                                <option class="text-capitalize" value="<%= workout.name %>"><%= workout.name %></option>
                                                            <% }) %>
                                                        </select>
                                                        <input type="number" name="saet" class="form-control"  placeholder="Sæt">
                                                        <input type="number" name="reps" class="form-control"  placeholder="Gentagelser">                                                          
                                                        <button 
                                                            type="button" 
                                                            onclick="createWorkout('<%=trainingPas.pasNumber%>' , '<%= muscleGroup.name %>', '<%= muscleGroup._id %>')" 
                                                            class="btn btn-outline-primary btn-sm">Ny Øvelse
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <hr>
                                    <% }) %>
                                        <!-- Add new musclegroup --> 
                                        <form id="muscleGroup<%= trainingPas.pasNumber %>" class="form-inline editButtons<%= trainingPas.pasNumber %>" style="display: none" action="<%= user._id %>/create/musclegroup" method="post">
                                            <div class="form-group">
                                                <select class="form-control text-capitalize" name="muscleGroup">
                                                    <% muscleGroups.forEach((musclegroup) => { %>
                                                        <option class="text-capitalize" value="<%= musclegroup%>"><%= musclegroup %></option>
                                                    <% }) %>
                                                </select>
                                                <input type="text" value="<%= trainingPas.pasNumber %>" style="display: none;" name="trainingPas">
                                                <button onclick="createMuscleGroup(<%= trainingPas.pasNumber %>)" class="btn btn-outline-primary pointer ml-1">Ny Muskelgruppe</button>
                                            </div>
                                        </form> 
                                    </div>  
                                </div>
                            </div>
                        <% }) %>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row my-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <div class="row">
                        <div class="col-9">
                            <h4>Kostplan</h4>
                        </div>
                        <div class="col-3">
                            <a   href="/" class="btn btn-primary float-right">Nyt pas</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                </div>
            </div>
        </div>
    </div>

</div>

<% include partials/footer %>